<div class="container">
  <% if user_signed_in? %>
    <div class="row"><div class="columnl"><%= link_to "Add Claim", new_claim_path,:class=>'btn btn btn-primary',:style=>'color:white; background-color:#4B99AD' %>
      <%= @filter_msg.html_safe %>
    </div><div class="columnr">
      <%= form_tag(claims_path, method: :get) do %>
        Search: <%= text_field_tag :q, params[:q] %>
        <%= submit_tag 'Search', name: nil, :class => 'btn btn btn-primary' %>
      <% end %></div></div>
      <hr>

    <% if (@claims.size==0) %>
      No results were returned.
    <% end %>
    <ul>
    <% @claims.each do |claim| %>
      <h4>
        <li><%= link_to claim.title, claim_path(claim) %>
        <small>(Reviews:
        <%
          @result2="<table><tr>"
          @reviews = ClaimReview.where("claim_id="+claim.id.to_s+" AND (user_id="+current_user.id.to_s+" OR (review_sharing_mode=1 AND review_verdict!=''))")
          if (@reviews.blank?) then @total_reviews=0; @results2=""
          else
            @total_reviews=@reviews.size
            assessments={"1"=>"False","2"=>"Mostly false","3"=>"Mixed","4"=>"Mostly true","5"=>"True","0"=>"No decision"}
            assessments2={"1"=>0,"2"=>0,"3"=>0,"4"=>0,"5"=>0,"0"=>0}
            @reviews.each do |rev|
              if rev.review_verdict.present? then
                  assessments2[rev.review_verdict.to_s]=assessments2[rev.review_verdict.to_s]+1
                end
            end
            result1=""
            assessments.each do |key, value|
                if assessments2[key]>0
                  result1=result1+" "+value+": "+assessments2[key].to_s
                  @result2=@result2+"<td><a href='"+claim_claim_reviews_path(claim.id)+"' target=_blank><img src='/"+key.to_s+".png' height=50 alt='"+value+" ("+assessments2[key].to_s+")' title='"+value+" ("+assessments2[key].to_s+")'></a></td>"
                end
            end
          end %>
          <%= link_to @total_reviews, claim_claim_reviews_path(claim.id) %>
       <% if (@total_reviews>0) %>
          <% if !result1.empty? %>
            [<%= result1 %>]
          <% end %>
      <% end %>
      <%
        @my_review = ClaimReview.where("claim_id="+claim.id.to_s+" AND user_id="+current_user.id.to_s).first
        if (@my_review.blank?)
            revtype ="Add" %>
           - <%= link_to "Add Review", claim_claim_reviews_path(claim.id), method: :create %>
        <% else
            revtype ="Edit" %>
           - <%= link_to "Edit Your Review", claim_claim_reviews_path(claim.id), method: :create %>, - <%= link_to "Delete Your Review", claim_claim_review_path(claim.id,@my_review), method: :delete, data: { confirm: "Are you sure?"} %>
        <% end %>
         )</small>
         <% if claim.url_preview.present? %>
           <% if @total_reviews>0 %>
            <br>
            <%
              url_prev=claim.url_preview.gsub('\"','"').gsub("\\'", "'")
              url_prev=url_prev.sub("</h3>","<div style='float: right'>"+@result2+"</td><td><a rel='nofollow' data-method='create' href='/claims/"+claim.id.to_s+"/claim_reviews' target=_blank><img src='/"+revtype+".png' height=70 alt='"+revtype+" review' title='"+revtype+" review'></a></td></tr></table></div></h3>")
            else
              url_prev=claim.url_preview.gsub('\"','"').gsub("\\'", "'")
              url_prev=url_prev.sub("</h3>","<div style='float: right'><a rel='nofollow' data-method='create' href='/claims/"+claim.id.to_s+"/claim_reviews' target=_blank><img src='/Add.png' height=70 alt='Add a review' title='Add a review'></a></div></h3>")
           end %>
          <%== url_prev %>
         <% end %>
      </li></h4>
    <% end %>
    </ul>
    <% if @total_count>10 then %> <%== pagy_bootstrap_nav(@pagy) %> <% end %>

    <% else %>
      <h4>Welcome to Fact Check Assistant! </h4> <br><hr><br>
      You can access the service by <b><%= link_to "signing in", new_user_session_path %></b>.
      <br><br>
      If you don't have an account, please <b><%= link_to "sign up", new_user_registration_path %></b>.
    <% end %>
</div>
