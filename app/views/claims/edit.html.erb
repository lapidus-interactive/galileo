<div class="form-claim">
<fieldset>
  <legend>&nbsp;Edit a claim</legend>
<%= form_for @claim do |f| %>
  <% if f.object.errors.any? %>
  <div class="error_messages">
      <% f.object.errors.full_messages.each do |error| %>
        <p><%= error %></p>
      <% end %>
  </div>
  <% end %>
<ul>
  <li>Give a brief title for the claim<span class='required'>*</span>
  <%= f.text_field :title, class: 'field-long' %>
  </li>
  <li>
  URL of where the claim is found (if available)
  <%= f.text_field :url, :onfocusout => "URLPreview('claim')", class: 'field-long' %>
  </li>
  <div id="url_preview"></div>
  <li>
  What was the medium where the claim was published (e.g., Twitter, Facebook, New York Times, etc.)? Leave blank if unknown or unsure.
  <%= f.text_field :medium_name, input_html: { data: {autocomplete_source: media_path }, :onfocusout => "NewMedium('medium','media','media')"} %>
  </li>
  <div id="medium_note"></div>
  <li>
  Who is the source (creator, author, writer) that produced the claim? Leave blank if unknown or unsure.
  <%= f.text_field :src_name, input_html: { data: {autocomplete_source: srcs_path }, :onfocusout => "NewMedium('src','srcs','sources')"} %>
  </li>
  <div id="src_note"></div>
  <li>
    Does the claim depend on or use an image?<span class='required'>*</span>
    <%= f.select :has_image, options_for_select([['Select',''],['Yes', 1],[' No', -1],[' Not sure', 0]], :selected => @claim.has_image) %>
  </li>
  <li>
    Does the claim depend on or use a video?<span class='required'>*</span>
      <%= f.select :has_video, options_for_select([['Select',''],['Yes', 1],[' No', -1],[' Not sure', 0]], :selected => @claim.has_video) %>
  </li>
  <li>
    Does the claim depend on or use text?<span class='required'>*</span>
      <%= f.select :has_text, options_for_select([['Select',''],['Yes', 1],[' No', -1],[' Not sure', 0]], :selected => @claim.has_text) %>
  </li>
  <li>
  Any more details about the claim you wish to add?
  <%= f.text_area(:description, size: '50x10', class: 'field-long field-textarea') %>
  </li>
  <li>
    <%= f.submit 'Submit', :class => 'btn btn btn-primary' %>
  </li>
</ul>
</fieldset>
<% end %>

<script>
function NewMedium(s,p,w) {
  const element = document.getElementById('claim_'+s+'_name');
  var q = element.value;
  q=$.trim(q);
  const note = document.getElementById(s+'_note');
  if (q.length==0) { note.innerHTML=''; return ; }

  $.ajax({
    url: '/'+p+'/?term='+q,
    cache: false
  })
    .done(function( html ) {
      var found=false;
      var entry="";
      for(var i = 0; i < html.length; i++)
        {
          if (html[i].toLowerCase()==q.toLowerCase())
            {
              entry=html[i]
              found=true;
              break;
            }
        }
      if (found)
        {
          element.value=entry
          note.innerHTML='';
        }
      else
        {
          note.innerHTML='<b><font color=red>'+q+'</font></b> is new and will be added automatically to the '+w+' database. You can find it by clicking on the <a href="/'+p+'" target=_blank>'+w+' page</a> after submitting this form.<br><br>';
        }
    });
}
function URLPreview(s)
 {
  $("#url_preview").html("<br><center><img src='/assets/loading.gif' width=50></center><br>");
  const element = document.getElementById(s+'_url');
  var q = element.value;
  q=$.trim(q);
  if (q.length==0) { $("#url_preview").html(""); return ; }
  $.ajax({
    url: '/claims/',
    type: 'get',
    data: { url: q },
    dataType: "text",
    success:function(result)
      {
        if (result.length>0) { $("#url_preview").html(result); }
        else { $("#url_preview").html("<center><small>[URL does not have a preview]</small></center>"); }
      },
    error:function()
      {
        $("#url_preview").html("<center><small>[URL does not have a preview]</small></center>");
      }
    });
 }
</script>

<%= link_to 'Show', @claim %> |
<%= link_to 'Back', claims_path %>
</div>
